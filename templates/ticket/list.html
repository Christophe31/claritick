{% extends "base.html" %}

{% load comments %}

{% block title %}Liste des tickets{% endblock %}
{% block content_title %}Liste des tickets{% endblock %}
{% block image %}<img src="/media/images/oxygen/search.png" />{% endblock %}

{% block content %}

<fieldset>
  <legend>Filtrage</legend>
  <form method="POST">
    <table class="search">
{{ form.as_column_table }}
    </table>
    <span class="bouton"><img class="bouton_img" src="/media/images/oxygen/cancel.png" /><input type="reset" value="Annuler" /></span>
    <span class="bouton"><img class="bouton_img" src="/media/images/oxygen/ok.png" /><input type="submit" value="Rechercher" /></span>
  </form>
</fieldset>

<h2>Résultats</h2>
{% if table.rows %}
<table class="resultat" dojoType="dijit.Grid">
<tr>
    {% for column in table.columns %}
    <th><a href="?sort={{ column.name_toggled }}">{{ column }}</a> 
    {% if column.is_ordered %}
      {% if column.is_ordered_straight %}
      <img src="/media/images/oxygen/arrow-up.png" alt="up" />
      {% else %}
      <img src="/media/images/oxygen/arrow-down.png" alt="down" />
      {% endif %}
    {% endif %}
    </th>
    {% endfor %}
</tr>
{% for row in table.rows %}
    {% get_comment_count for ticket.ticket row.id as comment_count %}
    <tr>
        <td style="width: 60px;"><a href="/ticket/modify/{{ row.id }}">{{ row.id }}</a></td>
        <td style="width: 200px;">{{ row.client }}</td>
        <td style="width: 100px;">{{ row.category }}</td>
        <td style="width: 100px;">{% if row.project %}{{ row.project }}{% endif %}</td>
        <td style="min-width: 250px;"><a href="/ticket/modify/{{ row.id }}">{{ row.title }}</a></td>
        <td>({{ comment_count }})</td>
        <td>{{ row.contact }}</td>
        <td style="width: 150px;">{{ row.last_modification|date:'d/m/Y H\hi' }}</td>
        <td>{{ row.opened_by }}</td>
        <td>{{ row.assigned_to }}</td>
    </tr>
{% endfor %}
</table>
{% else %}
<h3>Aucun résultat</h3>
{% endif %}

{% endblock %}
